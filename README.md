# 装甲板识别

### 自适应阈值分割

通过寻找领域像素值的高斯均值或均值来确定二值化的像素阈值。

高斯加权均值就是领域中间像素的权重更大。

```cpp
cv::adaptiveThreshold
```

**只用自适应阈值会出现一个现象，那就是本来一大块黑色的地方会出现一块被二值化为1的区域，所以应该将自适应阈值与普通阈值取交集**

### 提取蓝色区域

值得注意的是，曝光时间太长会让蓝色区域变成高亮的白色区域。因此我们需要降低曝光时间。但同时亮度会下降，在提取高亮区域的时候会出现些许问题，需要找到一个平衡点。

### 关于像素格式

像素格式也就是BGR图还是灰度图等。

像素格式是没有办法在GUI界面进行修改的，需要先使用SDK进行修改之后再到GUI界面查看。

### 关于装甲板确定

识别的灯条本质上两个旋转角度相近的旋转矩形。

因此要确定装甲板的位置实际上可以找到以灯条为对边的旋转矩形的中心点。

然后确定两个灯条的旋转角度的平均值。

最后根据中心点、旋转角度、装甲版尺寸和灯条尺寸的关系即可确定装甲板。

### 相机标定

使用matlab对相机进行标定，得到的内参矩阵和畸变系数如下：
$$
\left[\begin{matrix} 4621 & 0 & 771 \\ 0 & 4622 & 636 \\ 0 & 0 & 1 \end{matrix} \right]
$$

$$
\left[\begin{matrix} k_1 & k_2 & p_1 & p_2 & k_3 \end{matrix}\right] \ = \ \left[ \begin{matrix} -0.0650 & 0.07247 & 0 & 0 & 0 \end{matrix}  \right] 
$$

### 装甲板中心点确定

角点在相机坐标系下的坐标通过中心点、灯条长度、灯条距离来确定。

通过opencv自带的SolvePnP函数进行PnP解算。

并实时输出装甲板中心点在相机坐标系下的坐标，也就是tvec。 

